
当执行Set的SMEMBER命令时，除了时间复杂度高以外，还需要很大内存空间，当可使用的内存空间不够时，考虑使用布隆过滤器。

布隆过滤器主要用途：使用固定的、非常小的内存来检测一个元素是否存在。

布隆过滤器特点：
- 不是直接存储数据，而是只存储数据对应的hash值。
- 当布隆过滤器确定元素不存在时，那么元素就一定不存在；当布隆过滤器返回元素存在时，元素只是可能存在。
- 布隆过滤器可以堆叠，堆叠多个布隆过滤器会导致存在性检查时间变长，因为检查一个元素是否存在，首先会查询最上层过滤器，返回负数（不存在），会接着查询下层的过滤器。

# 创建布隆过滤器

）创建布隆过滤器。
```
BF.RESERVE FILETER_NAME ERROR_RATE CAPACITY [EXPANSION expansion] [NONSCALING]
```
参数：
- ERROR_RATE：假阳率（False positives rate），0~1。<font color=44cf57>布隆过滤器判断一个元素存在</font> 这一判断错误的比率。如果希望假阳率是0.1%，值应该设为0.001。
- CAPACITY：容量。当容量过大，那么会浪费内存空间；当容量过小，如果一个过滤器满载后，一个新的过滤器会堆叠在之前的过滤器上，此时添加操作所花费的时间不变，存在性检查操作所花费的时间变多。
- EXPANSION expansion：如果布隆过滤器的数量不能增加，那么会使得假阳率增大。指定该选项后，会允许布隆过滤器容量满载后动态堆叠一个新的布隆过滤器，新的布隆过滤器容量为最后一个堆叠的布隆过滤器容量乘以expansion。（如果存储在布隆过滤器中的元素容量难以确认，推荐使用2或者更多来减少布隆过滤器的数量，默认的expansion为2，否则推荐使用1来减少内存消耗）
- NONSCALING：不允许布隆过滤器的数量增加。


# 布隆过滤器其他相关命令

）向布隆过滤器中添加元素（同时创建布隆过滤器）。
```bash
BF.ADD FILTER_NAME ELEMENT
```
）向过滤器中同时添加多个元素（同时创建布隆过滤器）。
```
BF.MADD FILTER_NAME ELEMENT_1 ELEMENT_2 ...
```
）测试元素是否存在：存在返回1，不存在返回0。
```bash
BF.EXISTS FILTER_NAME ELEMENT
```
）同时测试多个元素是否存在：每个元素的测试结果都会有一个返回值。
```
BF.MEXISTS FILTER_NAME ELEMENT_1 ELEMENT_2 ..
```

# 布隆过滤器内存消耗

布隆过滤器的内存消耗公式计算如下：
```text
bits_per_item = -log(error)/ln(2)
memory = capacity * bits_per_item
```
- 要达到1%的假阳率，每个元素的hash需要10.08个比特存储。
- 要达到0.1%的假阳率，每个元素的hash需要14.4个比特存储。
- 要达到0.01%的假阳率，每个元素的hash需要20.16个比特存储。




# 面试题目